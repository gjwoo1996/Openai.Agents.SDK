services:
  workspace:
    container_name: personal_agents_sdk_devcontainer
    image: mcr.microsoft.com/devcontainers/base:bullseye
    command: sleep infinity

    ports:
      - "25173:5173" # 프론트엔드 (Vite 개발 서버)
      - "28080:8080" # 백엔드

    volumes:
      - ..:${containerWorkspaceFolder}:cached

    depends_on:
      mariadb:
        condition: service_healthy

    env_file:
      - .env

    environment:
      - TZ=Asia/Seoul

    networks:
      - dev-network

  mariadb:
    container_name: openai_agents_sdk_mariadb
    image: mariadb:11.3
    ports:
      - "23306:3306"
    volumes:
      - ./data:/var/lib/mysql
    environment:
      - TZ=Asia/Seoul
      - MYSQL_ROOT_PASSWORD=mysqlrootpassword
      - MYSQL_DATABASE=Chatbot
      - MYSQL_USER=appuser
      - MYSQL_PASSWORD=apppassword
    networks:
      - dev-network
    healthcheck:
      test: ["CMD", "healthcheck.sh", "--connect", "--innodb_initialized"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 30s

networks:
  dev-network:
    driver: bridge
